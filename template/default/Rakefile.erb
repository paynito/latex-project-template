MAIN_TEX_FILE = "<%= @main_tex_file %>"

gem 'filename'
autoload :FileName, 'filename'

desc "Default"
task :default => :pdf

desc "Create dvi"
task :dvi => [MAIN_TEX_FILE] do |t|
  sh "latexmk -dvi #{MAIN_TEX_FILE}"
end

desc "Create ps"
task :ps => [MAIN_TEX_FILE] do |t|
  sh "latexmk -ps #{MAIN_TEX_FILE}"
end

desc "Create pdf"
task :pdf => [MAIN_TEX_FILE] do |t|
  sh "latexmk -pdf #{MAIN_TEX_FILE}"
end

desc "Clean up"
task :clean do |t|
  sh "latexmk -c"
end

desc "Clean up completely"
task :distclean do |t|
  sh "latexmk -C"
end

desc "Create snapshot pdf"
task :snapshot => :pdf do |t|
  pdf_path = FileName.create(MAIN_TEX_FILE, :add => :prohibit, :extension => '.pdf')
  snapshot_path = FileName.create("snapshot", File.basename(pdf_path), :type => :time, :directory => :parent,
                                  :position => :middle, :delimiter => '', :add => :always,
                                  :format => "%Y%m%d_%H%M%S")
  move(pdf_path, snapshot_path)
end
